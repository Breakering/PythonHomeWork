<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="x-ua-compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Title</title>
    <link rel="stylesheet" href="css/common.css">
</head>
<body>
    <div class="header">
        <div class="menu fleft">
            <input type="button" value="全选" />
            <input type="button" value="反选" />
            <input type="button" value="取消" />
        </div>
        <div class="edit fleft">进入编辑模式</div>
    </div>
    <div>
        <table border="1">
            <thead>
                <tr>
                    <th>选择</th>
                    <th>主机名</th>
                    <th>端口</th>
                    <th>状态</th>
                </tr>
            </thead>
            <tbody id="table1">
                <tr>
                    <td><input type="checkbox"></td>
                    <td>v1</td>
                    <td>3306</td>
                    <td class="line-or-not">在线</td>
                </tr>
                <tr>
                    <td><input type="checkbox"></td>
                    <td>v1</td>
                    <td>3306</td>
                    <td class="line-or-not">下线</td>
                </tr>
                <tr>
                    <td><input type="checkbox"></td>
                    <td>v1</td>
                    <td>3306</td>
                    <td class="line-or-not">下线</td>
                </tr>
            </tbody>
        </table>
    </div>
    <script src="js/jquery-1.12.4.js"></script>
    <script>
        $(".menu input[value='全选']").click(function () {
            $("#table1 :checkbox").prop("checked", true);
            if($(".edit").hasClass("editing")){       // 编辑状态下处理方法
                $("#table1").children().each(function () {  // 循环每一行
                    var flag = $(this).children(":eq(1)").children(":eq(0)").is("input");
                    if(flag){
                    }else{                  // 只有不是编辑形态才会进行形态切换
                        editRow(this);
                    }
                })
            };
        });
        $(".menu input[value='取消']").click(function () {
            $("#table1 :checkbox").prop("checked", false);
            if($(".edit").hasClass("editing")){       // 编辑状态下处理方法
                $("#table1").children().each(function () {  // 循环每一行
                    var flag = $(this).children(":eq(1)").children(":eq(0)").is("input");
                    if(flag){               // 是编辑形态下才会切换为非编辑形态
                        uneditRow(this);
                    }
                })
            };
        });
        $(".menu input[value='反选']").click(function () {
            $("#table1 :checkbox").each(function () {
                $(this).prop("checked", $(this).prop("checked") ? false : true);
                if($(".edit").hasClass("editing")){       // 编辑状态下处理方法
                $("#table1").children().each(function () {  // 循环每一行
                    var flag = $(this).children(":eq(1)").children(":eq(0)").is("input");
                    if(flag){                // 编辑形态则切换为非编辑形态
                        uneditRow(this);
                    }else{                   // 非编辑形态则切换为编辑形态
                        editRow(this);
                    }
                })
            };
            })
        });
        $(".edit").click(function () {
            $(this).toggleClass("editing");   // 编辑和非编辑状态自由切换
            var edit_flag = $(this).hasClass("editing");   // 获取是否是编辑状态
            $("#table1").children().each(function () {     // 循环表格的每一行
                if($(this).find(":checkbox").prop("checked")){  // 判断checkbox是否被选中
                    if(edit_flag){                         // 是编辑状态
                        editRow(this);
                    }else{                                 // 不是编辑状态
                        uneditRow(this);
                    }
                }
            })
        });
        function editRow(self) {
            $(self).children().eq(0).nextUntil(".line-or-not").each(function () {  // 循环不是状态的每个单元格
                var info = $(this).text();                               // 获取该单元格的信息
                $(this).html("<input type='text' value='"+info+"'>");    // 更改单元格内容
            });
            var select_tag = document.createElement("select");      // 创建一个select标签
            var option_tag1 = document.createElement("option");     // 创建一个option标签
            var option_tag2 = document.createElement("option");
            $(select_tag).attr("name", "status");
            $(option_tag1).text("在线").attr("value", 1);           // 给option标签设置内容
            $(option_tag2).text("下线").attr("value", 2);
            $(select_tag).append(option_tag1).append(option_tag2);  // 将option标签放入select标签
            var option_selected = $(self).children(".line-or-not").text();   // 获取当前的选择内容
            $(select_tag).children(":contains("+option_selected+")").attr("selected", "selected");  // 根据当前选择内容改变select标签的选择状态
            $(self).children(".line-or-not").empty().append(select_tag);  // 将状态单元格的内容替换为select标签
        };
        function uneditRow(self) {
            $(self).children().eq(0).nextUntil(".line-or-not").each(function () {  // 循环不是状态的每个单元格
                var info = $(this).children(":text").val();  // 获取该单元格的信息
                $(this).html(info);  // 更改单元格内容
            });
            var option_selected = $(self).children(".line-or-not").find("select option:selected").text();  // 获取当前的选择内容
            $(self).children(".line-or-not").empty().text(option_selected);  // 将状态单元格的内容替换为文字
        };
        $("#table1 :checkbox").click(function () {
            var flag = $(this).parent().next().children(":eq(0)").is("input");
            if($(".edit").hasClass("editing")){       // 是编辑状态
                if($(this).is(':checked')){          // 被选中
                    if(flag){
                    }else{                           // 非编辑状态才会切换为编辑状态
                       editRow($(this).parent().parent()[0]);
                    }
                }else{
                    if(flag){                        // 是编辑状态才会切换为非编辑状态
                       uneditRow($(this).parent().parent()[0]);
                    }
                }
            };
        });
        $("#table1 tr td select").click(function(e){
            console.log(1);
            if(e.ctrlKey){
                console.log(1)
            }
        })
    </script>
</body>
</html>